Include %occInclude

Class fdw.Installer
{

XData fdwManifest [ XMLNamespace = INSTALLER ]
{
<Manifest>
   <SystemSetting Name="Config.config.MaxServers" Value="30" />
   <SystemSetting Name="Config.config.MaxServerConn" Value="30" />
   <SystemSetting Name="Config.Journal.CurrentDirectory" Value="/irisjrn/jrn" />
   <SystemSetting Name="Config.Journal.AlternateDirectory" Value="/irisjrn/alt" />
   <Namespace  Name="%SYS" Create="no" Code="IRISSYS" Data="IRISSYS"  >
     <Configuration>
       <Database Name="fdw1" Dir="/irisdb/fdw/fdw1/" Create="overwrite" />
       <Database Name="fdwpriv" Dir="/irisdb/fdw/fdwpriv/" Create="overwrite" />
      </Configuration>
     <Invoke Class="fdw.Installer" Method="EnableECPService" CheckStatus="1" />
   </Namespace>
</Manifest>
}

/// This is a method generator whose code is generated by XGL.
ClassMethod setup(ByRef pVars, pLogLevel As %Integer = 3, pInstaller As %Installer.Installer, pLogger As %Installer.AbstractLogger) As %Status [ CodeMode = objectgenerator, Internal ]
{
    #; Let our XGL document generate code for this method. 
    Quit ##class(%Installer.Manifest).%Generate(%compiledclass, %code, "fdwManifest")
}

// Enable the ECP Service for the system.

ClassMethod EnableECPService() As %Status
{
  set tsc = $$$OK
  try {
    set tService=##class(Security.Services).%OpenId("%service_ecp")
    if $ISOBJECT(tService) {
      set tService.Enabled=1
      set tsc=tService.%Save()
    }
  }
  catch ex {
    set tsc=ex.AsStatus()
  }
  return tsc
}

}
